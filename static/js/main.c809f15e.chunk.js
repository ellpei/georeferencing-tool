(this["webpackJsonpmap-coordinate-collector"]=this["webpackJsonpmap-coordinate-collector"]||[]).push([[0],{50:function(e,t,a){},51:function(e,t,a){},53:function(e,t,a){},60:function(e,t,a){},61:function(e,t,a){},62:function(e,t,a){},63:function(e,t,a){"use strict";a.r(t);var n=a(1),r=a(0),o=a.n(r),s=a(20),i=a.n(s),c=(a(50),a(8)),l=a(9),d=a(11),h=a(10),j=(a(51),a(52),a(53),a(38)),u=a(68),p=a(25),b=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).handleDropdownChange=function(e){n.setState({val:e.target.value})},n.handleStart=function(){var e=n.state,t=e.uploadedMap,a=e.val,r=e.useGeoCoords;null==t?n.props.onSelect(a,r):n.props.onUpload(t,r)},n.handleFileChange=function(e){null!=e.target.files[0]&&n.setState({uploadedMap:URL.createObjectURL(e.target.files[0])})},n.state={val:n.props.resorts[0].id,uploadedMap:null},n}return Object(l.a)(a,[{key:"render",value:function(){return Object(n.jsx)("div",{id:"mapform",children:Object(n.jsx)("div",{className:"vertical-center",children:Object(n.jsx)(j.a,{className:"selectcontainer",children:Object(n.jsxs)(u.a,{children:[Object(n.jsx)(u.a.Label,{className:"form-title",children:"Welcome!"}),Object(n.jsxs)(u.a.Group,{controlId:"exampleForm.ControlSelect1",children:[Object(n.jsx)(u.a.Label,{children:"Select or upload ski map"}),Object(n.jsx)(u.a.Control,{as:"select",onChange:this.handleDropdownChange,children:this.props.resorts.map((function(e){return Object(n.jsx)("option",{value:e.id,children:e.title},e.title)}))}),Object(n.jsx)("br",{}),Object(n.jsx)(u.a.File,{onChange:this.handleFileChange,multiple:!1,accept:"image/png, image/jpeg"}),Object(n.jsx)("br",{}),this.state.uploadedMap?Object(n.jsxs)("div",{className:"image-wrapper",children:[Object(n.jsx)("img",{src:this.state.uploadedMap,alt:"preview"}),Object(n.jsx)("br",{}),Object(n.jsx)("br",{})]}):null]}),Object(n.jsx)(p.b,{to:"/matcher",onClick:this.handleStart,className:"btn btn-primary",children:"Start!"})]})})})})}}]),a}(o.a.Component),O=a(44),f=(a(60),a(66)),m=a(24),x=(a(61),a(65)),v=a(39),g=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var n;Object(c.a)(this,a),(n=t.call(this,e)).changeFileType=function(e){var t=e.target.value;n.setState({fileType:t})},n.download=function(e){var t;e.preventDefault();var a=n.props.points;if("json"===n.state.fileType){var r=a.map((function(e){return{id:e.id,name:e.name,shortName:e.shortName,areaId:e.areaId,pisteMapCoordinates:{x:e.x,y:e.y}}}));t=JSON.stringify({points:r},null,4)}else if("csv"===n.state.fileType){var o=[];o.push(["id","name","shortName","areaId","x","y"]),a.map((function(e){return o.push([e.id,e.name,e.shortName,e.areaId,e.x,e.y])})),t=n.makeCSV(o)}var s=new Blob([t]),i=URL.createObjectURL(s);n.setState({fileDownloadUrl:i},(function(){n.dofileDownload.click(),URL.revokeObjectURL(i),n.setState({fileDownloadUrl:""})}))},n.upload=function(e){e.preventDefault(),n.dofileUpload.click()},n.makeCSV=function(e){var t="";return e.forEach((function(e){e.forEach((function(e,a){var n=(void 0===e?"":e.toString()).replace(/"/g,'""');n.search(/("|,|\n)/g)>=0&&(n='"'+n+'"'),a>0&&(t+=","),t+=n})),t+="\n"})),t},n.openFile=function(e){var t=e.target.files[0],a=new FileReader;if(t instanceof Blob){var r=function(e){var t=e.target.result;try{var a=JSON.parse(t);a.hasOwnProperty("lifts")?n.props.loadPointData(a.lifts):a.hasOwnProperty("slopes")?n.props.loadPointData(a.slopes):a.hasOwnProperty("restaurants")?n.props.loadPointData(a.restaurants):alert("Unable to load JSON data, missing key value lifts, slopes or restaurants")}catch(e){alert(e)}};r=r.bind(Object(m.a)(n)),a.onload=r,a.readAsText(t)}},n.downloadTestReport=function(e){console.log("generating test report"),e.preventDefault();var t=n.props.generateTestReport(),a=JSON.stringify({testReport:t},null,4),r=new Blob([a]),o=URL.createObjectURL(r);n.setState({fileDownloadUrl:URL.createObjectURL(r)},(function(){n.doTestReportDownload.click(),URL.revokeObjectURL(o),n.setState({fileDownloadUrl:""})}))};var r=n.props.imgSrc,o=r.substr(r.lastIndexOf("/")+1,r.length);return o=o.substr(0,o.lastIndexOf(".")),n.fileNames={json:String(o)+".json",csv:String(o)+".csv"},n.state={fileType:"json",fileDownloadUrl:null,resort:o},n}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return Object(n.jsx)("div",{id:"fileForm",children:Object(n.jsx)(j.a,{children:Object(n.jsxs)(x.a,{className:"justify-content-md-center",children:[Object(n.jsx)(v.a,{md:"auto",children:Object(n.jsxs)(u.a.Control,{as:"select",name:"fileType",className:"fileForm-child",onChange:this.changeFileType,value:this.state.fileType,children:[Object(n.jsx)("option",{value:"csv",children:"CSV"}),Object(n.jsx)("option",{value:"json",children:"JSON"})]})}),Object(n.jsxs)(v.a,{md:"auto",children:[Object(n.jsx)(f.a,{onClick:this.download,className:"fileForm-child",children:"Download"}),Object(n.jsx)("a",{className:"hidden",download:this.fileNames[this.state.fileType],href:this.state.fileDownloadUrl,ref:function(t){return e.dofileDownload=t},children:"download it"})]}),Object(n.jsxs)(v.a,{md:"auto",children:[Object(n.jsx)(f.a,{onClick:this.upload,className:"fileForm-child",children:"Upload"}),Object(n.jsx)("input",{type:"file",className:"hidden",multiple:!1,accept:".json,application/json",onChange:function(t){return e.openFile(t)},ref:function(t){return e.dofileUpload=t}})]})]})})})}}]),a}(o.a.Component),C=a(19),D=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(){var e;Object(c.a)(this,a);for(var n=arguments.length,r=new Array(n),o=0;o<n;o++)r[o]=arguments[o];return(e=t.call.apply(t,[this].concat(r))).onMouseDown=function(t){t.stopPropagation(),e.props.moveDot(e.props.i)},e}return Object(l.a)(a,[{key:"render",value:function(){var e=this.props,t=e.dotX,a=e.dotY,r=e.styles,o=e.dotRadius;return Object(n.jsx)("div",{className:"react-image-dot",onMouseDown:this.onMouseDown,style:Object(C.a)(Object(C.a)({},r),{},{height:2*o,width:2*o,transform:"translate(".concat(-o,", ").concat(-o,")"),top:a||0,left:t||0})})}}]),a}(o.a.Component);D.defaultProps={dotRadius:1};var y=a(27),w=(a(62),function(e){return e.show?Object(n.jsx)("div",{className:"modal-backdrop",onClick:e.clicked}):null}),S=a(22),k=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).clearFields=function(){n.setState({id:"",name:"",shortName:"",areaId:""})},n.onKeyPress=function(e){"Enter"===e.key&&n.props.handleSave(n.state)},n.handleInputChange=function(e){var t=e.target,a=t.value,r=t.name;n.setState(Object(y.a)({},r,a))},n.state={id:n.props.currentDot.id,name:n.props.currentDot.name,shortName:n.props.currentDot.shortName,areaId:n.props.currentDot.areaId},n}return Object(l.a)(a,[{key:"render",value:function(){var e=this,t=this.props.handleClose,a=window.innerWidth,r=this.props.posX>a/2?0:Math.round(.525*a);return Object(n.jsx)("div",{id:"geoCoordSelector",children:Object(n.jsxs)("div",{className:"coord-selector",children:[Object(n.jsx)(w,{show:!0,clicked:t}),Object(n.jsxs)(S.a,{className:"modal-body",style:{top:10,left:r},children:[Object(n.jsxs)(S.a.Body,{children:[Object(n.jsx)(S.a.Title,{children:"Edit point data"}),Object(n.jsxs)(u.a,{children:[Object(n.jsxs)(u.a.Group,{as:x.a,children:[Object(n.jsx)(u.a.Label,{column:!0,children:"x"}),Object(n.jsx)(v.a,{sm:4,children:Object(n.jsx)(u.a.Control,{type:"number",defaultValue:this.props.currentDot.x,onChange:function(t){e.props.updateCurrentDot({x:t.target.value})}})}),Object(n.jsx)(u.a.Label,{column:!0,children:"y"}),Object(n.jsx)(v.a,{sm:4,children:Object(n.jsx)(u.a.Control,{type:"number",defaultValue:this.props.currentDot.y,onChange:function(t){e.props.updateCurrentDot({y:t.target.value})}})})]}),Object(n.jsxs)(u.a.Group,{as:x.a,children:[Object(n.jsx)(u.a.Label,{column:!0,children:"id"}),Object(n.jsx)(v.a,{sm:8,children:Object(n.jsx)(u.a.Control,{type:"text",placeholder:"Enter id...",name:"id",defaultValue:this.state.id,onChange:this.handleInputChange})})]}),Object(n.jsxs)(u.a.Group,{as:x.a,children:[Object(n.jsx)(u.a.Label,{column:!0,children:"name"}),Object(n.jsx)(v.a,{sm:8,children:Object(n.jsx)(u.a.Control,{type:"text",placeholder:"Enter name...",name:"name",defaultValue:this.state.name,onChange:this.handleInputChange})})]}),Object(n.jsxs)(u.a.Group,{as:x.a,children:[Object(n.jsx)(u.a.Label,{column:!0,children:"shortName"}),Object(n.jsx)(v.a,{sm:8,children:Object(n.jsx)(u.a.Control,{type:"text",placeholder:"Enter shortName...",name:"shortName",defaultValue:this.state.shortName,onChange:this.handleInputChange})})]}),Object(n.jsxs)(u.a.Group,{as:x.a,children:[Object(n.jsx)(u.a.Label,{column:!0,children:"areaId"}),Object(n.jsx)(v.a,{sm:8,children:Object(n.jsx)(u.a.Control,{type:"text",placeholder:"Enter areaId...",name:"areaId",defaultValue:this.state.areaId,onChange:this.handleInputChange,onKeyPress:this.onKeyPress})})]})]})]}),Object(n.jsxs)(S.a.Footer,{children:[Object(n.jsx)(f.a,{variant:"secondary",onClick:t,children:"Delete"}),Object(n.jsx)(f.a,{variant:"secondary",onClick:t,children:"Close"}),Object(n.jsx)(f.a,{variant:"primary",onClick:function(){return e.props.handleSave(e.state)},children:"Save"})]})]})]})})}}]),a}(o.a.Component),N=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).onLoadPisteMap=function(e){var t=e.target;n.setState({dimensions:{renderWidth:t.offsetWidth,renderHeight:t.offsetHeight,realWidth:t.naturalWidth,realHeight:t.naturalHeight}})},n.onMouseUp=function(e){var t=e.target.getBoundingClientRect(),a=n.state,r=a.dimensions,o=a.currentDot,s=Math.round(n.renderedToRealCoord(e.clientX-t.left,r.renderWidth,r.realWidth)),i=Math.round(n.renderedToRealCoord(e.clientY-t.top,r.renderHeight,r.realHeight));if(0===Object.keys(o).length){var c={x:s,y:i};n.setState({grabbing:!1,showModal:!0,currentDot:c})}},n.updateCurrentDot=function(e){var t=n.state.currentDot;n.setState({currentDot:Object(C.a)(Object(C.a)({},t),e)})},n.moveDot=function(e){var t=n.props.dots[e];n.setState({grabbing:!0,currentDot:t,showModal:!0}),n.props.deleteDot(e)},n.resetDots=function(){n.props.resetDots()},n.renderedToRealCoord=function(e,t,a){return e/t*a},n.realToRenderedCoord=function(e,t,a){return e/a*t},n.handleShowModal=function(){n.setState({showModal:!0})},n.handleCloseModal=function(){n.setState({grabbing:!1,showModal:!1,currentDot:{}})},n.handleSave=function(e){console.log(JSON.stringify(e));var t=n.state.currentDot;n.setState({currentDot:Object(C.a)(Object(C.a)({},t),e)},(function(){this.props.saveDot(this.state.currentDot),this.handleCloseModal()}))},n.state={grabbing:!1,dimensions:{},currentDot:{}},n}return Object(l.a)(a,[{key:"render",value:function(){var e=this,t=this.state,a=t.grabbing,r=t.currentDot,o=this.state.dimensions,s=this.props,i=s.dots,c=s.backgroundImageUrl,l=s.dotRadius,d=a?"react-image-dot__grabbing":"";return Object(n.jsxs)("div",{id:"react-image-dot",children:[Object(n.jsxs)("div",{className:"react-image-dot__wrapper ".concat(d," no-select"),onMouseUp:this.onMouseUp,width:o.realWidth,height:o.realHeight,children:[Object(n.jsx)("img",{id:"pistemap-img",src:c,alt:"Piste map",width:o.realWidth,onLoad:this.onLoadPisteMap}),i.map((function(t,a){return Object(n.jsx)(D,{dotX:Math.round(e.realToRenderedCoord(t.x,o.renderWidth,o.realWidth)),dotY:Math.round(e.realToRenderedCoord(t.y,o.renderHeight,o.realHeight)),i:a,styles:{boxShadow:"0px 0px 0px 2px purple",backgroundColor:"purple"},moveDot:e.moveDot,dotRadius:l},a)})),0===Object.keys(r).length?null:Object(n.jsx)(D,{dotX:Math.round(this.realToRenderedCoord(r.x,o.renderWidth,o.realWidth)),dotY:Math.round(this.realToRenderedCoord(r.y,o.renderHeight,o.realHeight)),i:0,styles:{boxShadow:"0px 0px 0px 2px green",backgroundColor:"green"},moveDot:function(){return console.log("try to move temp dot")},dotRadius:l},-1)]}),"number of points: ",this.props.dots.length,this.state.showModal?Object(n.jsx)(k,{dimensions:o,posX:this.realToRenderedCoord(r.x,o.renderWidth,o.realWidth),handleClose:this.handleCloseModal,handleSave:this.handleSave,updateCurrentDot:this.updateCurrentDot,currentDot:this.state.currentDot}):null,this.props.resetDots&&Object(n.jsx)("button",{onClick:this.resetDots,children:"Reset"})]})}}]),a}(o.a.Component);N.defaultProps={pixelCoordinates:!0,backgroundSize:"cover"};var R=a(41);function M(e){var t=e.dots,a=e.deleteDot;return Object(n.jsxs)(R.a,{hover:!0,size:"sm",children:[Object(n.jsx)("thead",{children:Object(n.jsxs)("tr",{children:[Object(n.jsx)("th",{children:"#"}),Object(n.jsx)("th",{children:"id"}),Object(n.jsx)("th",{children:"name"}),Object(n.jsx)("th",{children:"shortName"}),Object(n.jsx)("th",{children:"areaId"}),Object(n.jsx)("th",{children:"x"}),Object(n.jsx)("th",{children:"y"}),Object(n.jsx)("th",{children:"delete"})]})}),Object(n.jsx)("tbody",{children:t.map((function(e,t){return Object(n.jsxs)("tr",{children:[Object(n.jsxs)("td",{children:[t," "]}),Object(n.jsx)("td",{children:e.id}),Object(n.jsx)("td",{children:e.name}),Object(n.jsx)("td",{children:e.shortName}),Object(n.jsx)("td",{children:e.areaId}),Object(n.jsx)("td",{children:e.x}),Object(n.jsx)("td",{children:e.y}),Object(n.jsx)("td",{children:Object(n.jsx)(f.a,{variant:"danger",onClick:function(){return a(t)},children:"\xd7"})})]},t)}))})]})}var L=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).addDot=function(e){var t=n.state.dots;n.setState({dots:[].concat(Object(O.a)(t),[e])})},n.saveDot=function(e){var t=n.state.dots;n.deleteDot(t.length-1),n.addDot(e)},n.deleteDot=function(e){n.setState({dots:n.state.dots.filter((function(t,a){return a!==e}))})},n.resetDots=function(){n.setState({dots:n.initialDots})},n.handleResize=function(){n.setState({windowWidth:.98*window.innerWidth})},n.loadPointData=function(e){var t=e.map((function(e){return{id:e.id,name:e.name,shortName:e.shortName,areaId:e.areaId,x:e.pisteMapCoordinates?e.pisteMapCoordinates.x:0,y:e.pisteMapCoordinates?e.pisteMapCoordinates.y:0}}));n.initialDots=t,n.setState({dots:t})},n.initialDots=[],n.state={title:n.props.resort.title,src:n.props.resort.src,dots:n.initialDots,windowWidth:.98*window.innerWidth},n}return Object(l.a)(a,[{key:"renderedToRealCoord",value:function(e,t,a){return e/t*a}},{key:"realToRenderedCoord",value:function(e,t,a){return e/a*t}},{key:"componentDidMount",value:function(){window.addEventListener("resize",this.handleResize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleResize)}},{key:"render",value:function(){var e=this.state,t=e.dots,a=e.src;return Object(n.jsxs)("div",{id:"matcher",children:[Object(n.jsx)(N,{backgroundImageUrl:a,onLoadMap:this.onLoadPisteMap,parents:[],dots:t,deleteDot:this.deleteDot,saveDot:this.saveDot,addDot:this.addDot,dotRadius:1}),Object(n.jsxs)("div",{className:"bottom-toolbox",children:[Object(n.jsx)(g,{imgSrc:this.state.src,points:this.state.dots,loadPointData:this.loadPointData}),Object(n.jsx)(M,{dots:this.state.dots,deleteDot:this.deleteDot}),Object(n.jsx)(f.a,{variant:"success",onClick:this.resetDots,children:"Reset"})]})]})}}]),a}(o.a.Component),T=[{id:0,src:"./assets/are.png",title:"\xc5re"},{id:1,src:"./assets/bjornen.png",title:"\xc5re Bj\xf6rnen"},{id:2,src:"./assets/duved.png",title:"Duved"},{id:3,src:"./assets/bjornrike.png",title:"Bj\xf6rnrike"},{id:4,src:"./assets/vemdalsskalet.png",title:"Vemdalsskalet"},{id:5,src:"./assets/hemsedal.png",title:"Hemsedal"},{id:6,src:"./assets/salen-lindvallen.png",title:"Lindvallen"},{id:7,src:"./assets/salen-hogfjallet.png",title:"H\xf6gfj\xe4llet"},{id:8,src:"./assets/salen-hundfjallet.png",title:"Hundfj\xe4llet"}];var U=function(e){return Object(n.jsx)("div",{id:"docs",children:Object(n.jsx)("h1",{children:"Docs"})})};var I=function(e){return Object(n.jsx)("div",{id:"about",children:Object(n.jsxs)("div",{className:"page-content",children:[Object(n.jsx)("h1",{children:"About"}),Object(n.jsx)("p",{children:"This georeferencing tool comes with two different collection modes. The standard mode matches geographic coordinates (lat, lng) with map coordinates (x, y). When enough points have been collected, it will make suggestions on where to place the geographic marker for each piste map coordinate. The exported file structure is in triangle format. The other mode collects only piste map coordinates (x, y). For each collected coordinate, you may also specify id, name, shortName, and area id."})]})})},W=a(67),P=a(69),F=a(6),H=function(e){Object(d.a)(a,e);var t=Object(h.a)(a);function a(e){var n;return Object(c.a)(this,a),(n=t.call(this,e)).setResort=function(e,t){n.setState({resortObject:T[e],useGeoCoords:t})},n.uploadMap=function(e,t){n.setState({resortObject:{src:e,title:"MyMap"},useGeoCoords:t})},n.state={resortObject:null,useGeoCoords:!0},n}return Object(l.a)(a,[{key:"render",value:function(){var e=this;return Object(n.jsx)("div",{className:"App",children:Object(n.jsxs)(p.a,{children:[Object(n.jsxs)(W.a,{className:"navbar",bg:"light",variant:"light",children:[Object(n.jsx)(W.a.Brand,{href:"/",children:Object(n.jsx)("div",{className:"header",children:Object(n.jsx)("h1",{children:"Georeferencing Tool"})})}),Object(n.jsxs)(P.a,{className:"mr-auto",children:[Object(n.jsx)(P.a.Link,{href:"/docs",children:"Docs"}),Object(n.jsx)(P.a.Link,{href:"/about",children:"About"})]})]}),Object(n.jsxs)(F.d,{children:[Object(n.jsx)(F.b,{exact:!0,path:"/",children:Object(n.jsx)(b,{resorts:T,onSelect:this.setResort,onUpload:this.uploadMap})}),Object(n.jsx)(F.b,{path:"/docs",children:Object(n.jsx)(U,{})}),Object(n.jsx)(F.b,{path:"/about",children:Object(n.jsx)(I,{})}),Object(n.jsx)(F.b,{path:"/matcher",children:e.state.resortObject?Object(n.jsx)(L,{resort:e.state.resortObject}):Object(n.jsx)(F.a,{to:{pathname:"/",state:{from:e.props.location}}})})]})]})})}}]),a}(o.a.Component),E=function(e){e&&e instanceof Function&&a.e(3).then(a.bind(null,70)).then((function(t){var a=t.getCLS,n=t.getFID,r=t.getFCP,o=t.getLCP,s=t.getTTFB;a(e),n(e),r(e),o(e),s(e)}))};i.a.render(Object(n.jsx)(H,{}),document.getElementById("root")),E()}},[[63,1,2]]]);
//# sourceMappingURL=main.c809f15e.chunk.js.map